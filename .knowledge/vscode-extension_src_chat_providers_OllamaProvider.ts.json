{"is_source_file": true, "format": "TypeScript", "description": "This file implements the OllamaProvider class for streaming chat completions from a local Ollama server, including configuration handling and streaming logic.", "external_files": ["vscode", "../ChatService"], "external_methods": ["vscode.CancellationToken.onCancellationRequested", "fetch", "reader.cancel", "reader.read", "TextDecoder.prototype.decode"], "published": ["OllamaProvider"], "classes": [{"name": "OllamaProvider", "description": "A class that streams chat messages from a local Ollama server, supporting streaming, cancellation, and configurable parameters."}], "methods": [{"name": "constructor(opts: { constructor", "description": "Initializes an instance of OllamaProvider with optional configuration parameters.", "scope": "OllamaProvider", "scopeKind": "class"}, {"name": "private mapMessages(messages: ChatMessage[]) { mapMessages", "description": "Prepares chat messages in the format expected by Ollama, inserting system prompt if necessary.", "scope": "OllamaProvider", "scopeKind": "class"}, {"name": "stream( stream", "description": "Streams chat responses from the Ollama server, calling callbacks with each delta and upon completion, supporting cancellation.", "scope": "OllamaProvider", "scopeKind": "class"}], "calls": ["fetch", "reader.getReader", "reader.read", "reader.cancel", "controller.abort", "token.onCancellationRequested"], "search-terms": ["OllamaProvider", "streaming chat", "local Ollama server", "ChatMessage", "chat completion streaming", "configurable baseURL", "CancellationToken"], "state": 2, "file_id": 27, "knowledge_revision": 136, "git_revision": "8d2848e0c0dd6eb902653875055f8d3ab464ce16", "revision_history": [{"74": ""}, {"136": "8d2848e0c0dd6eb902653875055f8d3ab464ce16"}], "ctags": [{"_type": "tag", "name": "OllamaProvider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^export class OllamaProvider implements ChatProvider {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly baseURL: string;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "body", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const body = {$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  constructor(opts: {$/", "language": "TypeScript", "kind": "method", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "controller", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const controller = new AbortController();$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "decoder", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^        const decoder = new TextDecoder('utf-8');$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "delta", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^              const delta = json?.message?.content;$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "done", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^          const { done, value } = await reader.read();$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "frequencyPenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly frequencyPenalty: number | undefined;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "hasSystem", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^      const hasSystem = messages.some(m => m.role === 'system');$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.mapMessages", "scopeKind": "method"}, {"_type": "tag", "name": "json", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^              const json = JSON.parse(trimmed);$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "line", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^          for (const line of lines) {$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "lines", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^          const lines = buffer.split('\\\\n');$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "mapMessages", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private mapMessages(messages: ChatMessage[]) {$/", "language": "TypeScript", "kind": "method", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "maxTokens", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly maxTokens: number | undefined;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^      messages: this.mapMessages(params.messages),$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const model = params.model || this.model;$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly model: string;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "presencePenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly presencePenalty: number | undefined;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "reader", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^        const reader = res.body.getReader();$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^        const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const result = messages.map(m => ({ role: m.role, content: m.content }));$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.mapMessages", "scopeKind": "method"}, {"_type": "tag", "name": "signal", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const signal = controller.signal;$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "stream", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  stream($/", "language": "TypeScript", "kind": "method", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const sub = token.onCancellationRequested(() => {$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "systemPrompt", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly systemPrompt: string | undefined;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "temperature", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly temperature: number | undefined;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^          const text = await res.text().catch(() => '');$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "topP", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^  private readonly topP: number | undefined;$/", "language": "TypeScript", "kind": "property", "scope": "OllamaProvider", "scopeKind": "class"}, {"_type": "tag", "name": "trimmed", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^            const trimmed = line.trim();$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^    const url = `${this.baseURL}\\/api\\/chat`;$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}, {"_type": "tag", "name": "value", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/providers/OllamaProvider.ts", "pattern": "/^          const { done, value } = await reader.read();$/", "language": "TypeScript", "kind": "constant", "scope": "OllamaProvider.stream", "scopeKind": "method"}], "hash": "396ee78d2f74fca87ec00dfdd3765cfb", "format-version": 4, "code-base-name": "frontend", "filename": "vscode-extension/src/chat/providers/OllamaProvider.ts", "fields": [{"name": "private readonly baseURL: string;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly frequencyPenalty: number | undefined;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly maxTokens: number | undefined;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly model: string;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly presencePenalty: number | undefined;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly systemPrompt: string | undefined;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly temperature: number | undefined;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly topP: number | undefined;", "scope": "OllamaProvider", "scopeKind": "class", "description": "unavailable"}]}