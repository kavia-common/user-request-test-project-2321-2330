{"is_source_file": true, "format": "TypeScript", "description": "This file defines a ChatService class that manages chat interactions with different providers (Mock, OpenAI, Ollama, LangChain). It handles provider initialization, streaming responses, cancellation, and communication with a webview in a VSCode extension.", "external_files": ["../messaging", "./providers/MockProvider", "./providers/OpenAIProvider", "./providers/OllamaProvider", "./providers/LangChainAgent"], "external_methods": ["postToWebview"], "published": ["ChatMessage", "ChatConfig", "ChatContext", "ChatProvider", "ChatService"], "classes": [{"name": "ChatService", "description": "A singleton class managing chat provider initialization, starting/stopping chat streams, and interaction with VSCode webview."}], "methods": [{"name": "attachContext", "description": "Attaches the VSCode extension context to the ChatService for secret storage access."}, {"name": "initProvider", "description": "Initializes the chat provider based on user configuration and secret keys."}, {"name": "getInstance", "description": "Returns the singleton instance of ChatService."}, {"name": "startStreaming", "description": "Begins streaming a chat response based on user input, manages provider selection, and posts partial responses to webview."}, {"name": "stop", "description": "Stops any ongoing chat response stream and communicates completion to the webview."}, {"name": "stream(params: { stream", "scope": "ChatProvider", "scopeKind": "interface", "description": "unavailable"}], "calls": ["postToWebview", "this.initProvider()", "this.provider.stream(...)", "this.stop()"], "search-terms": ["ChatService", "stream", "provider", "VscodeExtension", "initProvider", "startStreaming", "stopStreaming", "webview", "API key", "LangChainAgent", "OpenAIProvider", "OllamaProvider"], "state": 2, "file_id": 22, "knowledge_revision": 134, "git_revision": "8d097cc7e70833207fb92007b69cd59f1b829d63", "revision_history": [{"49": ""}, {"65": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"66": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"67": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"79": "2ca3b6d061148df6a9e1f4fc65320bf3ad24ab7a"}, {"91": "8d2848e0c0dd6eb902653875055f8d3ab464ce16"}, {"92": "8d2848e0c0dd6eb902653875055f8d3ab464ce16"}, {"105": "c187648fc404af9ec12e4741c1fd672c22348bed"}, {"106": "c187648fc404af9ec12e4741c1fd672c22348bed"}, {"107": "c187648fc404af9ec12e4741c1fd672c22348bed"}, {"122": "09174c7c6386acc5d1eccd8badec153825396517"}, {"123": "09174c7c6386acc5d1eccd8badec153825396517"}, {"124": "09174c7c6386acc5d1eccd8badec153825396517"}, {"125": "09174c7c6386acc5d1eccd8badec153825396517"}, {"133": "8d097cc7e70833207fb92007b69cd59f1b829d63"}, {"134": "8d097cc7e70833207fb92007b69cd59f1b829d63"}], "ctags": [{"_type": "tag", "name": "ChatConfig", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatConfig = Record<string, unknown>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatContext", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatContext = Record<string, unknown>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatMessage", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatMessage = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatProvider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export interface ChatProvider {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "ChatService", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export class ChatService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "assistantId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const assistantId = String(Date.now());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const baseURL = primary.get<string>('teCopilot.ollama.baseURL')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const baseURL = primary.get<string>('teCopilot.openai.baseURL')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cfg2", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const cfg2 = vscode.workspace.getConfiguration('teCopilot');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "context", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cts", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const cts = new vscode.CancellationTokenSource();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "frequencyPenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const frequencyPenalty = primary.get<number>('teCopilot.frequencyPenalty')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "instance", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  private static instance: ChatService | null = null;$/", "language": "TypeScript", "kind": "property", "scope": "ChatService", "scopeKind": "class"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      let key: string | undefined;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "legacyCopilo", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const legacyCopilo = vscode.workspace.getConfiguration('teCopilo');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "legacyCopilo2", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const legacyCopilo2 = vscode.workspace.getConfiguration('teCopilo');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "maxTokens", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const maxTokens = primary.get<number>('teCopilot.maxTokens')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const messages: ChatMessage[] = [{ role: 'user', content: userText }];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const model = primary.get<string>('teCopilot.ollama.model')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const model = primary.get<string>('teCopilot.openai.model')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "oldCfg", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const oldCfg = vscode.workspace.getConfiguration('kaviaChat');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "oldCfg2", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const oldCfg2 = vscode.workspace.getConfiguration('kaviaChat');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "presencePenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const presencePenalty = primary.get<number>('teCopilot.presencePenalty')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "primary", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const primary = vscode.workspace.getConfiguration('teCopilot');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "provider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  private provider: ChatProvider;$/", "language": "TypeScript", "kind": "property", "scope": "ChatService", "scopeKind": "class"}, {"_type": "tag", "name": "providerId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const providerId = ((cfg2.get<string>('teCopilot.provider') ?? legacyCopilo2.get<string>('/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "providerId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const providerId = ($/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resolvedModel", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      let resolvedModel = model;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "stream", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  stream(params: {$/", "language": "TypeScript", "kind": "method", "scope": "ChatProvider", "scopeKind": "interface"}, {"_type": "tag", "name": "systemPrompt", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const systemPrompt = primary.get<string>('teCopilot.systemPrompt')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "temperature", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const temperature = primary.get<number>('teCopilot.temperature')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "topP", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const topP = primary.get<number>('teCopilot.topP')$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "userText", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "webviewView", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}], "hash": "5944372ab7f441d5199c4734c5a50856", "format-version": 4, "code-base-name": "frontend", "filename": "vscode-extension/src/chat/ChatService.ts", "fields": [{"name": "export interface ChatProvider {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private static instance: ChatService | null = null;", "scope": "ChatService", "scopeKind": "class", "description": "unavailable"}, {"name": "let key: string | undefined;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private provider: ChatProvider;", "scope": "ChatService", "scopeKind": "class", "description": "unavailable"}, {"name": "let resolvedModel = model;", "scope": "", "scopeKind": "", "description": "unavailable"}]}