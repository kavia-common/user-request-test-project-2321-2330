{"is_source_file": true, "format": "TypeScript", "description": "This file defines the core chat service class for a VSCode extension, including methods to initialize chat providers, manage streaming chat responses, and handle provider selection based on configuration. It includes types and interfaces related to chat messages, provider abstraction, and the singleton class ChatService that orchestrates chat interactions.", "external_files": ["../messaging", "./providers/MockProvider", "./providers/OpenAIProvider", "./providers/OllamaProvider", "./providers/LangChainAgent", "vscode"], "external_methods": ["postToWebview"], "published": ["ChatMessage", "ChatConfig", "ChatContext", "ChatProvider", "ChatService"], "classes": [{"name": "ChatService", "description": "Singleton class managing chat provider initialization, streaming, and cancellation within a VSCode extension context."}], "methods": [{"name": "attachContext", "description": "Attaches the extension context to ChatService for secret storage access."}, {"name": "initProvider", "description": "Asynchronously initializes the chat provider based on current configuration and secrets."}, {"name": "getInstance", "description": "Retrieves the singleton instance of ChatService."}, {"name": "startStreaming", "description": "Starts streaming a chat response based on user input, managing provider setup and webview message posting."}, {"name": "stop", "description": "Stops the current streaming chat, cancelling ongoing provider streams and notifying the webview."}, {"name": "stream(params: { stream", "scope": "ChatProvider", "scopeKind": "interface", "description": "unavailable"}], "calls": ["postToWebview", "this.initProvider", "this.provider.stream", "this.provider = new MockProvider()", "this.provider = new LangChainAgent()", "this.provider = new OllamaProvider(...)", "this.provider = new OpenAIProvider(...)"], "search-terms": ["ChatService", "chat provider management", "streaming chat response", "VSCode extension chat", "provider initialization", "cancel token"], "state": 2, "file_id": 22, "knowledge_revision": 79, "git_revision": "2ca3b6d061148df6a9e1f4fc65320bf3ad24ab7a", "revision_history": [{"49": ""}, {"65": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"66": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"67": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"79": "2ca3b6d061148df6a9e1f4fc65320bf3ad24ab7a"}], "ctags": [{"_type": "tag", "name": "ChatConfig", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatConfig = Record<string, unknown>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatContext", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatContext = Record<string, unknown>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatMessage", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatMessage = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatProvider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export interface ChatProvider {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "ChatService", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export class ChatService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "assistantId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const assistantId = String(Date.now());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const baseURL = cfg.get<string>('kaviaChat.ollama.baseURL') || 'http:\\/\\/localhost:11434';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const baseURL = cfg.get<string>('kaviaChat.openai.baseURL') || 'https:\\/\\/api.openai.com\\//", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cfg", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const cfg = vscode.workspace.getConfiguration('kaviaChat');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cfg", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const cfg = vscode.workspace.getConfiguration('kaviaChat');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "context", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cts", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const cts = new vscode.CancellationTokenSource();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "frequencyPenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const frequencyPenalty = cfg.get<number>('kaviaChat.frequencyPenalty');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "instance", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  private static instance: ChatService | null = null;$/", "language": "TypeScript", "kind": "property", "scope": "ChatService", "scopeKind": "class"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      let key: string | undefined;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "maxTokens", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const maxTokens = cfg.get<number>('kaviaChat.maxTokens');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const messages: ChatMessage[] = [{ role: 'user', content: userText }];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "mode", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const mode = (cfg.get<string>('kaviaChat.mode') || 'assistant').toLowerCase();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const model = cfg.get<string>('kaviaChat.ollama.model') || 'llama3.1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const model = cfg.get<string>('kaviaChat.openai.model') || 'gpt-4o-mini';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "presencePenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const presencePenalty = cfg.get<number>('kaviaChat.presencePenalty');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "provider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  private provider: ChatProvider;$/", "language": "TypeScript", "kind": "property", "scope": "ChatService", "scopeKind": "class"}, {"_type": "tag", "name": "providerId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const providerId = (cfg.get<string>('kaviaChat.provider') || 'mock').toLowerCase();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "providerId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const providerId = (cfg.get<string>('kaviaChat.provider') || 'mock').toLowerCase();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resolvedModel", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      let resolvedModel = model;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "stream", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  stream(params: {$/", "language": "TypeScript", "kind": "method", "scope": "ChatProvider", "scopeKind": "interface"}, {"_type": "tag", "name": "systemPrompt", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const systemPrompt = cfg.get<string>('kaviaChat.systemPrompt') || undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "temperature", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const temperature = cfg.get<number>('kaviaChat.temperature');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "topP", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const topP = cfg.get<number>('kaviaChat.topP');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "userText", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "webviewView", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}], "hash": "7994cfa878b90bfaff5c3bb83403efd0", "format-version": 4, "code-base-name": "frontend", "filename": "vscode-extension/src/chat/ChatService.ts", "fields": [{"name": "export interface ChatProvider {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private static instance: ChatService | null = null;", "scope": "ChatService", "scopeKind": "class", "description": "unavailable"}, {"name": "let key: string | undefined;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private provider: ChatProvider;", "scope": "ChatService", "scopeKind": "class", "description": "unavailable"}, {"name": "let resolvedModel = model;", "scope": "", "scopeKind": "", "description": "unavailable"}]}