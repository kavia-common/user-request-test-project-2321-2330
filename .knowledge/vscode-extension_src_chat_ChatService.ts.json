{"is_source_file": true, "format": "TypeScript", "description": "This file implements the core chat service for a VSCode extension, including provider initialization (OpenAI, Ollama, LangChain, mock), streaming chat responses, managing cancellation tokens, and interfacing with the webview. It defines types, an interface for chat providers, and a singleton class for chat management.", "external_files": ["../messaging", "./providers/MockProvider", "./providers/OpenAIProvider", "./providers/OllamaProvider", "./providers/LangChainAgent", "vscode"], "external_methods": ["postToWebview"], "published": ["ChatService", "ChatProvider", "ChatMessage", "ChatConfig", "ChatContext"], "classes": [{"name": "ChatService", "description": "Singleton class managing chat provider initialization, streaming chat responses, cancelation, and interfacing with WebView in the VSCode extension."}], "methods": [{"name": "attachContext", "description": "Attaches VSCode extension context for secret storage access."}, {"name": "initProvider", "description": "Initializes the chat provider based on current workspace configuration and secrets."}, {"name": "getInstance", "description": "Returns the singleton instance of ChatService."}, {"name": "startStreaming", "description": "Begins streaming a chat response, handling provider selection, cancellation, and webview updates."}, {"name": "stop", "description": "Cancels ongoing streaming and signals completion to the webview."}, {"name": "stream(params: { stream", "scope": "ChatProvider", "scopeKind": "interface", "description": "unavailable"}], "calls": ["postToWebview", "this.initProvider", "this.provider.stream", "this.stop"], "search-terms": ["ChatService", "streaming chat", "provider initialization", "VSCode extension chat", "cancel token management", "webview messaging"], "state": 2, "file_id": 22, "knowledge_revision": 92, "git_revision": "8d2848e0c0dd6eb902653875055f8d3ab464ce16", "revision_history": [{"49": ""}, {"65": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"66": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"67": "ffb29648f9282e70bd62284544effa1223d8e053"}, {"79": "2ca3b6d061148df6a9e1f4fc65320bf3ad24ab7a"}, {"91": "8d2848e0c0dd6eb902653875055f8d3ab464ce16"}, {"92": "8d2848e0c0dd6eb902653875055f8d3ab464ce16"}], "ctags": [{"_type": "tag", "name": "ChatConfig", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatConfig = Record<string, unknown>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatContext", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatContext = Record<string, unknown>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatMessage", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export type ChatMessage = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ChatProvider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export interface ChatProvider {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "ChatService", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^export class ChatService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "assistantId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const assistantId = String(Date.now());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const baseURL = newCfg.get<string>('teCopilot.ollama.baseURL') ?? oldCfg.get<string>('kavi/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseURL", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const baseURL = newCfg.get<string>('teCopilot.openai.baseURL') ?? oldCfg.get<string>('kavi/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "context", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cts", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const cts = new vscode.CancellationTokenSource();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "frequencyPenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const frequencyPenalty = (newCfg.get<number>('teCopilot.frequencyPenalty') ?? oldCfg.get<n/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "instance", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  private static instance: ChatService | null = null;$/", "language": "TypeScript", "kind": "property", "scope": "ChatService", "scopeKind": "class"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      let key: string | undefined;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "maxTokens", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const maxTokens = (newCfg.get<number>('teCopilot.maxTokens') ?? oldCfg.get<number>('kaviaC/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const messages: ChatMessage[] = [{ role: 'user', content: userText }];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "mode", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const mode = ((newCfg.get<string>('teCopilot.mode') ?? oldCfg.get<string>('kaviaChat.mode') /", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const model = newCfg.get<string>('teCopilot.ollama.model') ?? oldCfg.get<string>('kaviaCha/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const model = newCfg.get<string>('teCopilot.openai.model') ?? oldCfg.get<string>('kaviaCha/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "newCfg", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const newCfg = vscode.workspace.getConfiguration('teCopilot');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "newCfg2", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const newCfg2 = vscode.workspace.getConfiguration('teCopilot');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "oldCfg", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const oldCfg = vscode.workspace.getConfiguration('kaviaChat');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "oldCfg2", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const oldCfg2 = vscode.workspace.getConfiguration('kaviaChat');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "presencePenalty", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const presencePenalty = (newCfg.get<number>('teCopilot.presencePenalty') ?? oldCfg.get<num/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "provider", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  private provider: ChatProvider;$/", "language": "TypeScript", "kind": "property", "scope": "ChatService", "scopeKind": "class"}, {"_type": "tag", "name": "providerId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const providerId = ((newCfg2.get<string>('teCopilot.provider') ?? oldCfg2.get<string>('kav/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "providerId", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const providerId = ((newCfg.get<string>('teCopilot.provider') ?? oldCfg.get<string>('kaviaCh/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resolvedModel", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      let resolvedModel = model;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "stream", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^  stream(params: {$/", "language": "TypeScript", "kind": "method", "scope": "ChatProvider", "scopeKind": "interface"}, {"_type": "tag", "name": "systemPrompt", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const systemPrompt = (newCfg.get<string>('teCopilot.systemPrompt') ?? oldCfg.get<string>('/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "temperature", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const temperature = (newCfg.get<number>('teCopilot.temperature') ?? oldCfg.get<number>('ka/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "topP", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^      const topP = (newCfg.get<number>('teCopilot.topP') ?? oldCfg.get<number>('kaviaChat.topP')/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "userText", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "webviewView", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/chat/ChatService.ts", "pattern": "/^    const { userText, config, context, model, webviewView } = params;$/", "language": "TypeScript", "kind": "constant"}], "hash": "5d49a57bff02d8b12c44f712198dae26", "format-version": 4, "code-base-name": "frontend", "filename": "vscode-extension/src/chat/ChatService.ts", "fields": [{"name": "export interface ChatProvider {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private static instance: ChatService | null = null;", "scope": "ChatService", "scopeKind": "class", "description": "unavailable"}, {"name": "let key: string | undefined;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private provider: ChatProvider;", "scope": "ChatService", "scopeKind": "class", "description": "unavailable"}, {"name": "let resolvedModel = model;", "scope": "", "scopeKind": "", "description": "unavailable"}]}