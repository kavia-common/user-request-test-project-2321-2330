{"is_source_file": true, "format": "TypeScript", "description": "This file contains command registration and utility functions for a VSCode extension related to MCP (maybe 'Mass Change Protocol' or similar). It provides functions to read, write, produce diffs, and apply diffs to files within a workspace, with command registration functions for integration with VSCode commands.", "external_files": ["vscode", "path", "fs/promises"], "external_methods": ["vscode.commands.registerCommand", "vscode.window.showWarningMessage", "vscode.window.showErrorMessage", "vscode.workspace.workspaceFolders", "vscode.window.activeTextEditor", "vscode.TextEditor.document.uri.fsPath"], "published": ["ensureMcpCommandsRegistered", "mcpReadFile", "mcpWriteFile", "mcpProduceDiff", "mcpDiffApply"], "classes": [], "methods": [{"name": "export function ensureMcpCommandsRegistered() { ensureMcpCommandsRegistered", "description": "Registers MCP-related commands with VSCode, ensuring they are registered only once.", "scope": "", "scopeKind": ""}, {"name": "export async function mcpReadFile(filePath?: string): Promise<string | undefined> { mcpReadFile", "description": "Reads the contents of a file within the workspace, returns the file contents or undefined if error.", "scope": "", "scopeKind": ""}, {"name": "export async function mcpWriteFile(filePath?: string, content?: string, options?: { append?: boo/ mcpWriteFile", "description": "Writes or appends content to a file within the workspace after user confirmation.", "scope": "", "scopeKind": ""}, {"name": "export async function mcpProduceDiff(filePath?: string): Promise<string | undefined> { mcpProduceDiff", "description": "Produces a minimal diff string for a file, including a header comment.", "scope": "", "scopeKind": ""}, {"name": "export async function mcpDiffApply(filePath?: string, diff?: string): Promise<boolean> { mcpDiffApply", "description": "Applies a diff (here simulated as prepending a header) to a file after user confirmation.", "scope": "", "scopeKind": ""}, {"name": "async function resolveWorkspacePath(filePath?: string): Promise<string | undefined> { resolveWorkspacePath", "description": "Resolves a provided file path to an absolute workspace-internal path, or uses the active editor's file.", "scope": "", "scopeKind": ""}], "calls": ["vscode.commands.registerCommand", "resolveWorkspacePath", "fs.stat", "fs.readFile", "fs.appendFile", "fs.writeFile", "path.join", "path.basename", "vscode.window.showWarningMessage", "vscode.window.showErrorMessage", "Date.prototype.toISOString"], "search-terms": ["mcpCommands", "vscode extension", "diff functions", "file operations", "workspace path resolution", "command registration"], "state": 2, "file_id": 29, "knowledge_revision": 128, "git_revision": "09174c7c6386acc5d1eccd8badec153825396517", "revision_history": [{"78": ""}, {"94": "8d2848e0c0dd6eb902653875055f8d3ab464ce16"}, {"109": "c187648fc404af9ec12e4741c1fd672c22348bed"}, {"110": "c187648fc404af9ec12e4741c1fd672c22348bed"}, {"128": "09174c7c6386acc5d1eccd8badec153825396517"}], "ctags": [{"_type": "tag", "name": "abs", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const abs = await resolveWorkspacePath(filePath);$/", "language": "TypeScript", "kind": "constant", "scope": "mcpReadFile", "scopeKind": "function"}, {"_type": "tag", "name": "abs", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const abs = await resolveWorkspacePath(filePath);$/", "language": "TypeScript", "kind": "constant", "scope": "mcpWriteFile", "scopeKind": "function"}, {"_type": "tag", "name": "abs", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const abs = await resolveWorkspacePath(filePath);$/", "language": "TypeScript", "kind": "constant", "scope": "mcpDiffApply", "scopeKind": "function"}, {"_type": "tag", "name": "abs", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const abs = await resolveWorkspacePath(filePath);$/", "language": "TypeScript", "kind": "constant", "scope": "mcpProduceDiff", "scopeKind": "function"}, {"_type": "tag", "name": "abs", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const abs = path.join(folders[0].uri.fsPath, filePath);$/", "language": "TypeScript", "kind": "constant", "scope": "resolveWorkspacePath", "scopeKind": "function"}, {"_type": "tag", "name": "after", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const after = before.startsWith(header) ? before : header + before;$/", "language": "TypeScript", "kind": "constant", "scope": "mcpDiffApply", "scopeKind": "function"}, {"_type": "tag", "name": "after", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const after = before.startsWith(header) ? before : header + before;$/", "language": "TypeScript", "kind": "constant", "scope": "mcpProduceDiff", "scopeKind": "function"}, {"_type": "tag", "name": "allowed", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const allowed = folders.some(f => filePath.startsWith(f.uri.fsPath));$/", "language": "TypeScript", "kind": "constant", "scope": "resolveWorkspacePath", "scopeKind": "function"}, {"_type": "tag", "name": "allowed", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const allowed = abs.startsWith(folders[0].uri.fsPath);$/", "language": "TypeScript", "kind": "constant", "scope": "resolveWorkspacePath", "scopeKind": "function"}, {"_type": "tag", "name": "before", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const before = (await fs.readFile(abs, 'utf-8').catch(() => '')) ?? '';$/", "language": "TypeScript", "kind": "constant", "scope": "mcpDiffApply", "scopeKind": "function"}, {"_type": "tag", "name": "before", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const before = (await fs.readFile(abs, 'utf-8').catch(() => '')) ?? '';$/", "language": "TypeScript", "kind": "constant", "scope": "mcpProduceDiff", "scopeKind": "function"}, {"_type": "tag", "name": "buf", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const buf = await fs.readFile(abs, 'utf-8');$/", "language": "TypeScript", "kind": "constant", "scope": "mcpReadFile", "scopeKind": "function"}, {"_type": "tag", "name": "diff", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const diff =$/", "language": "TypeScript", "kind": "constant", "scope": "mcpProduceDiff", "scopeKind": "function"}, {"_type": "tag", "name": "editor", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const editor = vscode.window.activeTextEditor;$/", "language": "TypeScript", "kind": "constant", "scope": "resolveWorkspacePath", "scopeKind": "function"}, {"_type": "tag", "name": "ensureMcpCommandsRegistered", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^export function ensureMcpCommandsRegistered() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "folders", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const folders = vscode.workspace.workspaceFolders;$/", "language": "TypeScript", "kind": "constant", "scope": "resolveWorkspacePath", "scopeKind": "function"}, {"_type": "tag", "name": "header", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const header = `\\/\\/ Updated by TE-Copilo at ${new Date().toISOString()}\\\\n`;$/", "language": "TypeScript", "kind": "constant", "scope": "mcpDiffApply", "scopeKind": "function"}, {"_type": "tag", "name": "header", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const header = `\\/\\/ Updated by TE-Copilot at ${new Date().toISOString()}\\\\n`;$/", "language": "TypeScript", "kind": "constant", "scope": "mcpProduceDiff", "scopeKind": "function"}, {"_type": "tag", "name": "mcpDiffApply", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^export async function mcpDiffApply(filePath?: string, diff?: string): Promise<boolean> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "mcpProduceDiff", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^export async function mcpProduceDiff(filePath?: string): Promise<string | undefined> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "mcpReadFile", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^export async function mcpReadFile(filePath?: string): Promise<string | undefined> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "mcpWriteFile", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^export async function mcpWriteFile(filePath?: string, content?: string, options?: { append?: boo/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const ok = await vscode.window.showWarningMessage($/", "language": "TypeScript", "kind": "constant", "scope": "mcpWriteFile", "scopeKind": "function"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^  const ok = await vscode.window.showWarningMessage($/", "language": "TypeScript", "kind": "constant", "scope": "mcpDiffApply", "scopeKind": "function"}, {"_type": "tag", "name": "registered", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^let registered = false;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "resolveWorkspacePath", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^async function resolveWorkspacePath(filePath?: string): Promise<string | undefined> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "stat", "path": "/home/kavia/workspace/code-generation/user-request-test-project-2321-2330/vscode-extension/src/commands/mcpTools.ts", "pattern": "/^    const stat = await fs.stat(abs).catch(() => null);$/", "language": "TypeScript", "kind": "constant", "scope": "mcpReadFile", "scopeKind": "function"}], "hash": "b0b50a0c3654f5ec104da986d3e49fd6", "format-version": 4, "code-base-name": "frontend", "filename": "vscode-extension/src/commands/mcpTools.ts", "fields": [{"name": "let registered = false;", "scope": "", "scopeKind": "", "description": "unavailable"}]}